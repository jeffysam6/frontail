<!DOCTYPE html>
<html>

<head>
    <title>tail -f __TITLE__</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="__PATH__/styles/__THEME__.css">
    <link rel="icon" href="__PATH__/favicon.ico">
    <script src="__PATH__/socket.io/socket.io.js"></script>
    <script src="__PATH__/tinycon.min.js"></script>
    <script src="__PATH__/ansi_up.js"></script>
    <script src="__PATH__/app.js"></script>
    <script>
        // var connect = function (ns) {
        //     return new io.connect(`/${ns}`, {
        //     query: 'ns='+ns,
        //     path: '__PATH__/socket.io',
        //     transports: ['websocket']
        //     });
        // }

        var socket = new io.connect(`/test`,{
        path: '__PATH__/socket.io',
        query: 'ns= ',
        transports: ['websocket']
        });

    </script>
    <script>
        function handleProcess(value=''){
            // document.body.innerHTML = "";

            // if(socket){
            //     socket.close()
            // }

            // console.log('is socket',socket == null)

            socket.close()

            socket = new io.connect(`/${value}`,{
                    path: '__PATH__/socket.io',
                    query: 'ns='+value,
                    transports: ['websocket']
                    });

            // socket = connect(value);

            console.log('process value',value,socket)

            const elements = document.getElementsByClassName('line');
            while(elements.length > 0){
                elements[0].parentNode.removeChild(elements[0]);
            }

            // socket.on('connect', function(){
            //     socket.emit('addprocessroom',value);
            // });

            // console.log("process value", value, 'namespace','__NAMESPACE__');
            // var xhr = new XMLHttpRequest();
            // xhr.open("POST", 'http://127.0.0.1:8080/process', true);
            // xhr.setRequestHeader('Content-Type', 'application/json');
            // xhr.send(JSON.stringify({
            //     value: value,
            // }));

           
            // var e = document.getElementById("processes");
            // var strUser = e.options[e.selectedIndex].text;

            App.init({
            socket: socket,
            container: document.getElementsByClassName('log')[0],
            filterInput: document.getElementsByClassName('query')[0],
            pauseBtn: document.getElementsByClassName('btn-pause')[0],
            topbar: document.getElementsByClassName('topbar')[0],
            body: document.getElementsByTagName('body')[0]
            });


            console.log('connected to namespace',value)
        }
    </script>
    <!-- <script>
        window.onload = handleProcess();
    </script> -->
</head>

<body>
    <nav class="topbar navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-8">
                    <span class="navbar-brand text-overflow" title="__TITLE__">tail -f __TITLE__</span>
                </div>
                <div class="col-sm-1 text-right">
                    <button type="button" class="btn btn-light btn-pause" data-toggle="button" aria-pressed="false" autocomplete="off"></button>
                </div>
                <div class="col-sm-3">
                    <form class="navbar-form-custom" role="search" onkeypress="return event.keyCode != 13;">
                        <input type="text" class="form-control query" placeholder="Filter" tabindex="1">
                    </form>
                    <form class="navbar-form-custom">
                        <label for="processes">Select a processes:</label>
                        <select name="processes" id="processes" onChange="handleProcess(this.value)">
                        <option value="" selected disabled hidden>Choose here</option>
                        <option value="streamlogger1.csv">streamlogger1</option>
                        <option value="streamlogger2.csv">streamlogger2</option>
                        </select>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid no-horiz-padding">
        <pre class="log"></pre>
    </div>
    <!-- <script src="__PATH__/socket.io/socket.io.js"></script>
    <script src="__PATH__/tinycon.min.js"></script>
    <script src="__PATH__/ansi_up.js"></script>
    <script src="__PATH__/app.js"></script>
    <script type="text/javascript">
        var socket = new io.connect({
            path: '__PATH__/socket.io',
            transports: ['websocket']
        });

        window.load = App.init({
            socket: socket,
            container: document.getElementsByClassName('log')[0],
            filterInput: document.getElementsByClassName('query')[0],
            pauseBtn: document.getElementsByClassName('btn-pause')[0],
            topbar: document.getElementsByClassName('topbar')[0],
            body: document.getElementsByTagName('body')[0]
        });
    </script> -->
</body>

</html>
